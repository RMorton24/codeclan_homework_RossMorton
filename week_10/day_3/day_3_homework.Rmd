---
title: "Week 10 day 3 homework"
output: html_notebook
---


```{r}
library(tidyverse)
library(modelr)
library(GGally)
library(ggfortify)
```

```{r}
kc_house <- read_csv(here::here("data/kc_house_data.csv"))
```

```{r}
head(kc_house)

glimpse(kc_house)

skimr::skim(kc_house)
```


## Question 1
Tidy up the data ready for regression

## Thoughts
Fields for removal 

* date - no need for this since this is the date of the sale
* id - no need
* zipcode - covered by longitude and latitude
* sqft...15 - will remove as this either has linear trend with the equivalent variable or has a large amount of deviation with
* sqft_above -  as this be sqft_living - basement

Rows for conversion:

* grade - convert into poor, average and high
* view and condition - convert to factor


Converting for 1/0 to logical is redundant so will not perform this.

```{r}
kc_house %>% 
  ggplot(aes(x = sqft_living15, y = price)) +
  geom_point()

kc_house %>% 
  ggplot(aes(x = sqft_living15, y = sqft_living)) +
  geom_point()

kc_house %>% 
  ggplot(aes(x = sqft_lot15, y = price)) +
  geom_point()

kc_house %>% 
  ggplot(aes(x = sqft_lot15, y = sqft_lot)) +
  geom_point()
```


## Code
```{r}
kings_county_house <- kc_house %>% 
  select(-c(date, id, zipcode, sqft_above), -contains("15")) %>% 
  mutate(yr_renovated = if_else(yr_renovated != 0, TRUE, FALSE),
         grade = factor(grade),
         condition = factor(condition),
         view = factor(view),
         waterfront = as.logical(waterfront))
```


## Question 2
Check for aliases using the alias()

Found that area above is redundant, so have removed.

```{r}
alias(lm(price ~., data = kings_county_house))
```



## Question 3

```{r}
ggpairs_plots <- function(data, main_columns){
  data %>% 
    select(where(is.numeric)) %>% 
    ggpairs(progress = FALSE) %>% 
    print()
  
  data %>% 
    select(-where(is.numeric), main_columns) %>% 
    ggpairs(progress = FALSE) %>% 
    print()
}
```





```{r}
kings_county_house %>% 
  ggpairs_plots(c("price"))
```


```{r}
kings_county_house %>% 
  ggcorr()
```

```{r}
kings_county_house %>% 
  ggplot(aes(x = log(sqft_living))) +
  geom_histogram()
```


```{r}
model_1_sqftliv <- lm(price ~ log(sqft_living),
                  data = kings_county_house)

summary(model_1_sqftliv)
autoplot(model_1_sqftliv)
```
```{r}
model_1_grade <- lm(price ~ grade, data = kings_county_house)

summary(model_1_grade)
```



```{r}
resid_model_1 <-  kings_county_house %>% 
  add_residuals(model_1_sqftliv)

resid_model_1 %>% 
  select(-sqft_living) %>% 
  ggpairs_plots(c("price", "resid"))
```

```{r}
model_2_lat <- lm(price ~ log(sqft_living) + lat,
                  data = kings_county_house)

summary(model_2_lat)
autoplot(model_2_lat)
```



```{r}
model_2_grade <- lm(price ~ log(sqft_living) + grade,
                  data = kings_county_house)

summary(model_2_grade)
```


```{r}
resid_2 <- kings_county_house %>% 
  add_residuals(model_2_grade)

resid_2 %>% 
  ggpairs_plots(c("resid"))
```



```{r}
model_3_long_lat <- lm(price ~ log(sqft_living) + grade + lat*long,
                       data = kings_county_house)

summary(model_3_long_lat)
autoplot(model_3_long_lat)
```


